<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ride Complete - Go Tawee</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/ride-tracking.css">
    <style>
        .completion-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            padding: 40px 20px;
            text-align: center;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--turf-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            animation: checkAnimation 0.6s ease-out;
        }

        @keyframes checkAnimation {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .completion-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--evergreen);
            margin-bottom: 8px;
            font-family: 'Inter', sans-serif;
        }

        .completion-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 32px;
            font-family: 'Inter', sans-serif;
        }

        .trip-summary {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 400px;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--evergreen);
            margin-bottom: 16px;
            font-family: 'Inter', sans-serif;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-family: 'Inter', sans-serif;
        }

        .summary-row:last-child {
            margin-bottom: 0;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 400px;
        }

        .btn {
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: var(--turf-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--evergreen);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: var(--evergreen);
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .rating-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 400px;
        }

        .rating-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--evergreen);
            margin-bottom: 16px;
            font-family: 'Inter', sans-serif;
        }

        .stars-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .star {
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .star svg {
            stroke: #ddd;
            fill: none;
            transition: all 0.3s ease;
        }

        .star.active svg {
            stroke: var(--amber-flame);
            fill: var(--amber-flame);
        }

        .star:hover {
            transform: scale(1.1);
        }

        .star:hover svg {
            stroke: var(--amber-flame);
            fill: var(--amber-flame);
        }

        .rating-comment {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: none;
            font-family: 'Inter', sans-serif;
        }

        .rating-comment:focus {
            outline: none;
            border-color: var(--turf-green);
        }
    </style>
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <button class="back-btn" onclick="window.location.href='ride-tracking.html'">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15,18 9,12 15,6"></polyline>
            </svg>
        </button>
        <h1 class="page-title">Ride Complete</h1>
        <button class="support-btn" id="supportBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"></path>
            </svg>
        </button>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="completion-container">
            <!-- Success Icon -->
            <div class="success-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
            </div>

            <h2 class="completion-title">Trip Completed!</h2>
            <p class="completion-message">Thank you for riding with Go Tawee. We hope you had a great experience!</p>

            <!-- Trip Summary -->
            <div class="trip-summary">
                <h3 class="summary-title">Trip Summary</h3>
                <div class="summary-row">
                    <span>Distance</span>
                    <span id="tripDistance">5.2 km</span>
                </div>
                <div class="summary-row">
                    <span>Duration</span>
                    <span id="tripDuration">12 min</span>
                </div>
                <div class="summary-row">
                    <span>Total Fare</span>
                    <span id="totalFare">₱45</span>
                </div>
            </div>

            <!-- Rating Section -->
            <div class="rating-section">
                <h3 class="rating-title">Rate Your Driver</h3>
                <div class="stars-container" id="starsContainer">
                    <span class="star" data-rating="1">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                        </svg>
                    </span>
                    <span class="star" data-rating="2">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                        </svg>
                    </span>
                    <span class="star" data-rating="3">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                        </svg>
                    </span>
                    <span class="star" data-rating="4">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                        </svg>
                    </span>
                    <span class="star" data-rating="5">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
                        </svg>
                    </span>
                </div>
                <textarea class="rating-comment" id="ratingComment" rows="3" placeholder="Share your feedback (optional)"></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="submitRatingBtn">Submit Rating</button>
                <button class="btn btn-secondary" id="bookAnotherBtn">Book Another Ride</button>
                <button class="btn btn-secondary" id="homeBtn">Go to Home</button>
            </div>
        </div>
    </main>

    <!-- Navigation -->
    <nav class="floating-nav">
        <div class="nav-item" onclick="window.location.href='../index.html'">
            <span class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9,22 9,12 15,12 15,22"></polyline>
                </svg>
            </span>
            <span class="nav-label">Home</span>
        </div>
        <div class="nav-item" onclick="window.location.href='search.html'">
            <span class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
            </span>
            <span class="nav-label">Search</span>
        </div>
        <div class="nav-item" onclick="window.location.href='orders.html'">
            <span class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14,2 14,8 20,8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10,9 9,9 8,9"></polyline>
                </svg>
            </span>
            <span class="nav-label">Orders</span>
        </div>
        <div class="nav-item active">
            <span class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M8 6v6h8V6"></path>
                    <path d="M4 12h16l-2-6H6l-2 6z"></path>
                    <circle cx="7" cy="18" r="2"></circle>
                    <circle cx="17" cy="18" r="2"></circle>
                    <path d="M5 16h3m5 0h7"></path>
                </svg>
            </span>
            <span class="nav-label">Rides</span>
        </div>
        <div class="nav-item" onclick="window.location.href='profile.html'">
            <span class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </span>
            <span class="nav-label">Profile</span>
        </div>
    </nav>

    <script>
        class RideCompletion {
            constructor() {
                this.rideData = this.loadRideData();
                this.selectedRating = 0;
                this.init();
            }

            init() {
                this.populateTripSummary();
                this.bindEvents();
            }

            loadRideData() {
                const stored = localStorage.getItem('currentRide');
                if (stored) {
                    return JSON.parse(stored);
                }
                
                // Default data if none found
                return {
                    distance: 5.2,
                    estimatedDuration: 12,
                    fare: 45
                };
            }

            populateTripSummary() {
                document.getElementById('tripDistance').textContent = `${this.rideData.distance} km`;
                document.getElementById('tripDuration').textContent = `${this.rideData.estimatedDuration} min`;
                document.getElementById('totalFare').textContent = `₱${this.rideData.fare}`;
            }

            bindEvents() {
                // Star rating
                const stars = document.querySelectorAll('.star');
                stars.forEach(star => {
                    star.addEventListener('click', () => {
                        this.selectRating(parseInt(star.dataset.rating));
                    });
                    
                    star.addEventListener('mouseover', () => {
                        this.highlightStars(parseInt(star.dataset.rating));
                    });
                });

                const starsContainer = document.getElementById('starsContainer');
                starsContainer.addEventListener('mouseleave', () => {
                    this.highlightStars(this.selectedRating);
                });

                // Buttons
                document.getElementById('submitRatingBtn').addEventListener('click', () => {
                    this.submitRating();
                });

                document.getElementById('bookAnotherBtn').addEventListener('click', () => {
                    window.location.href = 'ride-booking.html';
                });

                document.getElementById('homeBtn').addEventListener('click', () => {
                    window.location.href = '../index.html';
                });

                // Support button
                document.getElementById('supportBtn').addEventListener('click', () => {
                    alert('Support feature - Contact Go Tawee customer service for assistance.');
                });
            }

            selectRating(rating) {
                this.selectedRating = rating;
                this.highlightStars(rating);
            }

            highlightStars(rating) {
                const stars = document.querySelectorAll('.star');
                stars.forEach((star, index) => {
                    const svg = star.querySelector('svg');
                    if (index < rating) {
                        star.classList.add('active');
                    } else {
                        star.classList.remove('active');
                    }
                });
            }

            submitRating() {
                const comment = document.getElementById('ratingComment').value;
                
                if (this.selectedRating === 0) {
                    this.showNotification('Please select a rating first', 'warning');
                    return;
                }

                // Save rating data
                const ratingData = {
                    rideId: this.rideData.id || 'ride_' + Date.now(),
                    rating: this.selectedRating,
                    comment: comment,
                    timestamp: new Date().toISOString()
                };

                // In a real app, this would be sent to the server
                localStorage.setItem('lastRideRating', JSON.stringify(ratingData));
                localStorage.removeItem('currentRide'); // Clear completed ride

                this.showNotification('Thank you for your feedback!', 'success');
                
                // Redirect after delay
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 2000);
            }

            showNotification(message, type = 'info') {
                // Simple console log instead of toast notifications
                console.log(`${type.toUpperCase()}: ${message}`);
                
                // For important messages, use browser alert
                if (type === 'warning' || type === 'error') {
                    alert(message);
                }
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new RideCompletion();
        });
    </script>
</body>
</html>